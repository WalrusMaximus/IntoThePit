{% extends "layout.html" %}
{% from 'macros.html' import render_field, render_edit_field %}

{% block sidebar %}

<h4>{{user.username}}</h4>
<img class="user_profile_avatar" src="{{ url_for('static', filename=user.avatar.decode('utf-8'))}}" alt="profile image">

{% if img_updating and current_user == user %}
<a href="{{url_for('user',id=user.id)}}">Nevermind, don't change my image</a>
{% elif current_user == user %}
<a href="{{url_for('update_user',id=user.id)}}">Change Profile Image</a>
{% endif %}

{% if img_updating %}
    <form method="POST" enctype="multipart/form-data" action="" class="form">
        {{ form.hidden_tag() }}
        {% for field in form %}
            {{ render_field(field) }}
        {% endfor %}
    </form>
{% endif %}
{% endblock %}

{% block main_header %}
{% if rating %}
<a href="{{ url_for('user', id=rating.user_fk.id)}}">Changed my mind, I don't want to Update</a>
{% endif%}

{% endblock %}

{% block main %}
{% set img_url = user.avatar.decode('utf-8') %}
<h4>Ratings</h4>
    {% if rating %}
    <h4>Updating Post:</h4>
    <img class="inline-avatar" src="{{ url_for('static', filename=img_url)}}" alt=""><p>{{ rating.user_fk.username }} says: {{ rating.message }} about the {{ rating.rating_type }} at <a href="{{url_for('venue',id=rating.venue_fk)}}">{{ rating.venue_fk.name }}</a> and gave it a rating of {{ rating.rating }}/5</p>
        
        {% if form %}
        <form method="POST" action="" class="form">
            {{ form.hidden_tag() }}
            {% for field in form %}
                {{ render_edit_field(field,record) }}
            {% endfor %}
            <input type="submit" name="submit" placeholder="Submit">
        </form>
        {% endif %}
    {% endif %}
    {% for rating in ratings %}
    <img class="inline-avatar" src="{{ url_for('static', filename=img_url)}}" alt=""><p>{{ rating.user_fk.username }} says: {{ rating.message }} about the {{ rating.rating_type }} at <a href="{{url_for('venue',id=rating.venue_fk)}}">{{ rating.venue_fk.name }}</a> and gave it a rating of {{ rating.rating }}/5</p>
        {% if user == current_user %}
        <a href="{{ url_for('user_update_rating', id=rating.id)}}">Update</a> <a href="{{ url_for('delete_rating', id=rating.id, profile=True)}}">Delete</a>
        {% endif %}
    {% else %}
    <p>Looks like there are no ratings here..</p>
    {% endfor %}
    {% if favorite_bands %}
    <h5>Favorite Bands</h5>
    {% for favorite_band in favorite_bands %}
    <a href="{{url_for('band',id=favorite_band.band_fk)}}">{{favorite_band.band_fk.name}}</a>
    {% endfor %}
    {% elif no_favorites %}
    {% else %}
    <p>Looks like {{ user.username }} doesn't have any favorite bands...</p>
    {% endif %}

    {% if favorite_venues %}
    <h5>Favorite Venues</h5>
    {% for favorite_venue in favorite_venues %}
    <a href="{{url_for('venue',id=favorite_venue.venue_fk)}}">{{favorite_venue.venue_fk.name}}</a>
    {% endfor %}
    {% elif no_favorites %}
    {% else %}
    <p>Looks like {{ user.username }} doesn't have any favorite venues...</p>
    {% endif %}


    {% if bands_query and current_user == user %}
        <h4>Upcoming Events by Favorite Artists...</h4>
        <div id="favorite-band-events">
        </div>
    {% endif %}
    {% if venues_query and current_user == user %}
        <h4>Upcoming Events at Favorite Venues...</h4>
        <div id="favorite-venue-events">
        </div>
    {% endif %}

{% endblock %}


{% block script %}
    {% for band in approved_bands %}
        <script>
            bands.push("{{band}}")
        </script>
    {% endfor %}
    {% for band in bands_query %}
        <script>
            favBand({{band}})
        </script>
    {% endfor %}
    {% for venue in venues_query %}
        <script>
            favVenue({{venue}})
        </script>
    {% endfor %}
{% endblock %}