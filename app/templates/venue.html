{% extends "layout.html" %}
{% from 'macros.html' import render_field, render_edit_field %}

{% block sidebar %}

<h4>{{venue.name}}</h4>
<p>{{venue.about}}</p>
<img class="venue_img" src="{{ url_for('static', filename=venue.img.decode('utf-8'))}}" alt="">

{% if is_favorite %}
<p>This is one of your favorite venues!</p><a href="{{url_for('delete_favorite_venue',id=venue.id)}}">Unfavorite?</a>
{% else %}
<a href="{{url_for('add_favorite_venue', id=venue.id)}}">Add To Favorites</a>
{% endif %}


{% endblock %}

{% block main_header %}

{% if rating %}
<h4>Updating Rating:</h4>
<p><a href="{{url_for('user',id=rating.user_fk)}}">{{ rating.user_fk.username }}</a> says: {{ rating.message }}. {{rating.type}} {{ rating.rating }}/5</p>
<img class="inline-avatar" src="{{ url_for('static', filename=rating.user_fk.avatar.decode('utf-8'))}}" alt="">
{% elif show_ratings %}
<h4>Add new Rating:</h4>
{% endif %}

{% if event %}
{% elif show_events %}
<h4>Add new Event:</h4>
{% endif %}

{% if record %}
<form method="POST" action="" class="form">
    {{ form.hidden_tag() }}
    {% for field in form %}
        {{ render_edit_field(field, record) }}
    {% endfor %}
    <input type="submit" name="submit" placeholder="Submit">
</form>
{% else %}
<form method="POST" action="" class="form">
    {{ form.hidden_tag() }}
    {% for field in form %}
        {{ render_field(field) }}
    {% endfor %}
</form>
{% endif %}
{% if rating %}
<a href="{{ url_for('venue', id=rating.venue_fk.id)}}">Changed my mind, I don't want to Update</a>
{% endif%}

{% endblock%}

{% block main %}
    <div class="venue-ratings">
        <h4>Ratings</h4>
        {% for rating in ratings %}
            <p><a href="{{url_for('user',id=rating.user_fk)}}">{{ rating.user_fk.username }}</a> says: {{ rating.message }}. {{rating.type}} {{ rating.rating }}/5</p>
            <img class="inline-avatar" src="{{ url_for('static', filename=rating.user_fk.avatar.decode('utf-8'))}}" alt="">
            {% if rating.user_fk.id == current_user.id %}
            <a href="{{ url_for('venue_update_rating', id=rating.id)}}">Update</a> <a href="{{ url_for('delete_rating', id=rating.id, profile=False)}}">Delete</a>
            {% endif %}

        {% endfor %}
    </div>

    <div>
        <h4>Events</h4>
        {% for event in events %}
            <img class="inline-avatar" src="{{ url_for('static', filename=event.band_fk.img.decode('utf-8'))}}" alt="">
            <p><a href="{{url_for('band',id=event.band_fk)}}">{{ event.band_fk.name }}</a> is playing on {{ event.date }} at {{ event.venue_fk.name}}</p>
            {% if current_user.user_level == "walrus" %}
            <a href="{{ url_for('update_event', id=event.id)}}">Update</a> <a href="{{ url_for('delete_event', id=event.id)}}">Delete</a>
            {% endif %}

        {% endfor %}
        <div class="venue-events" id="venue-events">
        </div>
    </div>



{% endblock %}


{% block script %}
<script>
        venueApi()
</script>
{% endblock %}